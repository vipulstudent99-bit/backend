generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////////////////////////////////////////////
// ENUMS
//////////////////////////////////////////////////////

enum VoucherStatus {
  DRAFT
  POSTED
  CANCELLED
}

enum EntrySide {
  DEBIT
  CREDIT
}

enum AccountRole {
  CASH
  BANK
  SALES
  PURCHASE
  AR
  AP
  OWNER
}

enum PartyType {
  CUSTOMER
  SUPPLIER
  BOTH
}

enum BalanceSide {
  DR
  CR
}

//////////////////////////////////////////////////////
// CORE MODELS
//////////////////////////////////////////////////////

model Company {
  id                   String        @id @default(cuid())
  code                 String        @unique
  name                 String
  baseCurrency         String        @default("INR")
  fiscalYearStartMonth Int           @default(4)
  createdAt            DateTime      @default(now())

  accounts             Account[]
  accountTypes         AccountType[]
  voucherTypes         VoucherType[]
  vouchers             Voucher[]
  parties              Party[]
}

model AccountType {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String

  company   Company? @relation(fields: [companyId], references: [id])
  companyId String?

  accounts  Account[]
}

model Account {
  id            String      @id @default(cuid())
  code          String      @unique
  name          String
  role          AccountRole

  company       Company     @relation(fields: [companyId], references: [id])
  companyId     String

  accountType   AccountType @relation(fields: [accountTypeId], references: [id])
  accountTypeId String

  entries       Entry[]
}

//////////////////////////////////////////////////////
// PARTIES (Phase 1.5)
//////////////////////////////////////////////////////

model Party {
  id                  String      @id @default(cuid())
  code                String      @unique
  name                String
  type                PartyType
  phone               String?
  email               String?
  address             String?

  openingBalance      Decimal     @default(0) @db.Decimal(18, 2)
  openingBalanceSide  BalanceSide @default(DR)

  company             Company     @relation(fields: [companyId], references: [id])
  companyId           String

  vouchers            Voucher[]

  createdAt           DateTime    @default(now())
}

//////////////////////////////////////////////////////
// VOUCHERS
//////////////////////////////////////////////////////

model VoucherType {
  id        String   @id @default(cuid())
  code      String   @unique
  name      String

  company   Company @relation(fields: [companyId], references: [id])
  companyId String

  vouchers  Voucher[]
}

model Voucher {
  id            String        @id @default(cuid())
  company       Company       @relation(fields: [companyId], references: [id])
  companyId     String

  voucherType   VoucherType   @relation(fields: [voucherTypeId], references: [id])
  voucherTypeId String

  party         Party?        @relation(fields: [partyId], references: [id])
  partyId       String?

  // e.g. CASH_SALE, CREDIT_SALE, EXPENSE_PAYMENT, CASH_TO_BANK, etc.
  subType       String?

  // Assigned on POST â€” null while DRAFT
  voucherNumber Int?

  status        VoucherStatus @default(DRAFT)
  voucherDate   DateTime
  narration     String?

  entries       Entry[]

  createdAt     DateTime      @default(now())
}

model Entry {
  id        String    @id @default(cuid())
  voucher   Voucher   @relation(fields: [voucherId], references: [id])
  voucherId String

  account   Account   @relation(fields: [accountId], references: [id])
  accountId String

  side      EntrySide
  amount    Decimal   @db.Decimal(18, 2)
}
